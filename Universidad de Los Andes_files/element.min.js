define(["jquery","knockout","notifier","ccPasswordValidator","pubsub","CCi18n","ccConstants","navigation","ccLogger","ccRestClient","storageApi"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";return{elementName:"login-registration",modalMessageType:t.observable(""),modalMessageText:t.observable(""),showErrorMessage:t.observable(!1),userCreated:t.observable(!1),ignoreBlur:t.observable(!1),onLoad:function(t){var r=this;u.setLoginHandler(function(e){t.user().handleSamlLogin()}),e.Topic(i.topicNames.SAML_LOGIN_FAILURE).subscribe(function(e){l.getInstance().saveToMemory(o.CC_IS_SSO_LOGIN_FAILURE,!0);if(t.hasOwnProperty("user")){t.user().handleCancel();if(t.user().pageToRedirect()&&t.user().pageToRedirect()==t.links().checkout.route&&t.cart().items().length>0){var r=t.user().pageToRedirect();t.user().pageToRedirect(null),u.goTo(r)}t.user().pageToRedirect(null),n.clearError(t.WIDGET_ID),t.user().clearUserData(),t.user().profileRedirect()}else u.cancelLogin();n.sendError("LOGIN_SSO",s.t("ns.common:resources.loginError"),!0)}),t.user().readyToDisplay(!1),t.nameStudent(t.user().firstName());for(var a=0;a<t.user().dynamicProperties().length;a++)if(t.user().dynamicProperties()[a].id()==="OCS_NombresIdentitarios"&&t.user().dynamicProperties()[a].value()){t.nameStudent(t.user().dynamicProperties()[a].value());break}t.user().readyToDisplay(!0)},handleSamlLogin:function(e,t){return e.user().handleSamlLogin(),!0},handleSamlRegistration:function(e,t){return e.user().handleSamlRegistration(),!0},handleLogout:function(t){if(t.isUserProfileEdited())return!0;n.clearSuccess(this.WIDGET_ID),n.clearError(this.WIDGET_ID),t.updateLocalData(t.loggedinAtCheckout(),!1),e.Topic(i.topicNames.USER_LOGOUT_SUBMIT).publishWith([{message:"success"}])}}})